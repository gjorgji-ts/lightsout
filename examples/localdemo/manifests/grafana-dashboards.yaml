apiVersion: v1
kind: ConfigMap
metadata:
  name: lightsout-grafana-dashboards
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  lightsout-overview.json: |
    {
      "annotations": { "list": [] },
      "description": "Overview of all LightsOut schedules, workload counts, scaling operations, and errors.",
      "editable": true,
      "graphTooltip": 1,
      "id": null,
      "links": [],
      "panels": [
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
          "id": 100,
          "title": "Key Stats",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "thresholds": { "mode": "absolute", "steps": [{ "color": "text", "value": null }] },
              "color": { "mode": "thresholds" }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 5, "x": 0, "y": 1 },
          "id": 1,
          "options": {
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "orientation": "auto", "textMode": "auto", "colorMode": "value", "graphMode": "none", "justifyMode": "auto"
          },
          "title": "Total Schedules",
          "type": "stat",
          "targets": [{ "expr": "count(lightsout_schedule_state)", "legendFormat": "", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "orange", "value": 1 }] },
              "color": { "mode": "thresholds" }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 5, "x": 5, "y": 1 },
          "id": 2,
          "options": {
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "orientation": "auto", "textMode": "auto", "colorMode": "value", "graphMode": "none", "justifyMode": "auto"
          },
          "title": "Schedules Down",
          "type": "stat",
          "targets": [{ "expr": "count(lightsout_schedule_state == 0) or vector(0)", "legendFormat": "", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "color": { "mode": "thresholds" }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 5, "x": 10, "y": 1 },
          "id": 3,
          "options": {
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "orientation": "auto", "textMode": "auto", "colorMode": "value", "graphMode": "none", "justifyMode": "auto"
          },
          "title": "Schedules Up",
          "type": "stat",
          "targets": [{ "expr": "count(lightsout_schedule_state == 1) or vector(0)", "legendFormat": "", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "thresholds": { "mode": "absolute", "steps": [{ "color": "blue", "value": null }] },
              "color": { "mode": "thresholds" }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 5, "x": 15, "y": 1 },
          "id": 4,
          "options": {
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "orientation": "auto", "textMode": "auto", "colorMode": "value", "graphMode": "none", "justifyMode": "auto"
          },
          "title": "Total Managed Workloads",
          "type": "stat",
          "targets": [{ "expr": "sum(lightsout_managed_workloads) or vector(0)", "legendFormat": "", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] },
              "color": { "mode": "thresholds" }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 4, "x": 20, "y": 1 },
          "id": 5,
          "options": {
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "orientation": "auto", "textMode": "auto", "colorMode": "value", "graphMode": "none", "justifyMode": "auto"
          },
          "title": "Errors (24h)",
          "type": "stat",
          "targets": [{ "expr": "sum(increase(lightsout_scaling_errors_total[24h])) or vector(0)", "legendFormat": "", "refId": "A" }]
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
          "id": 101,
          "title": "Schedule State",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "align": "auto", "displayMode": "auto", "inspect": false },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] }
            },
            "overrides": [
              {
                "matcher": { "id": "byName", "options": "State" },
                "properties": [
                  { "id": "mappings", "value": [{ "options": { "0": { "text": "Down", "color": "orange" }, "1": { "text": "Up", "color": "green" } }, "type": "value" }] },
                  { "id": "custom.displayMode", "value": "color-background-solid" },
                  { "id": "custom.width", "value": 80 }
                ]
              },
              {
                "matcher": { "id": "byName", "options": "Next Transition" },
                "properties": [{ "id": "unit", "value": "s" }, { "id": "custom.width", "value": 140 }]
              },
              {
                "matcher": { "id": "byName", "options": "Managed Workloads" },
                "properties": [{ "id": "custom.width", "value": 140 }]
              },
              {
                "matcher": { "id": "byName", "options": "Errors (24h)" },
                "properties": [
                  { "id": "custom.width", "value": 100 },
                  { "id": "thresholds", "value": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] } },
                  { "id": "custom.displayMode", "value": "color-text" }
                ]
              },
              {
                "matcher": { "id": "byName", "options": "Schedule" },
                "properties": [
                  { "id": "links", "value": [{ "title": "View schedule detail", "url": "d/lightsout-schedule-detail/lightsout-schedule-detail?var-schedule=${__data.fields.Schedule}" }] }
                ]
              }
            ]
          },
          "gridPos": { "h": 8, "w": 24, "x": 0, "y": 6 },
          "id": 6,
          "options": { "showHeader": true, "footer": { "show": false } },
          "title": "All Schedules",
          "type": "table",
          "targets": [
            { "expr": "lightsout_schedule_state", "format": "table", "instant": true, "refId": "state" },
            { "expr": "min by (schedule) (lightsout_next_transition_seconds)", "format": "table", "instant": true, "refId": "transition" },
            { "expr": "sum by (schedule) (lightsout_managed_workloads)", "format": "table", "instant": true, "refId": "workloads" },
            { "expr": "sum by (schedule) (increase(lightsout_scaling_errors_total[24h]))", "format": "table", "instant": true, "refId": "errors" }
          ],
          "transformations": [
            { "id": "seriesToColumns", "options": { "byField": "schedule" } },
            { "id": "organize", "options": {
              "excludeByName": { "Time": true, "Time 1": true, "Time 2": true, "Time 3": true, "Time 4": true, "__name__": true, "__name__ 1": true, "__name__ 2": true, "__name__ 3": true, "job": true, "job 1": true, "job 2": true, "job 3": true, "instance": true, "instance 1": true, "instance 2": true, "instance 3": true, "namespace": true, "workload_type": true, "transition_type": true },
              "renameByName": { "schedule": "Schedule", "Value #state": "State", "Value #transition": "Next Transition", "Value #workloads": "Managed Workloads", "Value #errors": "Errors (24h)" }
            }}
          ]
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 14 },
          "id": 102,
          "title": "Activity Over Time",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 20, "pointSize": 5, "lineWidth": 2, "showPoints": "auto", "stacking": { "mode": "none" } },
              "color": { "mode": "palette-classic" },
              "unit": "ops"
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 8, "x": 0, "y": 15 },
          "id": 7,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Scaling Operations Rate",
          "type": "timeseries",
          "targets": [{ "expr": "sum by (operation) (rate(lightsout_scaling_operations_total[$__rate_interval]))", "legendFormat": "{{ operation }}", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 30, "lineWidth": 2, "showPoints": "auto", "stacking": { "mode": "none" } },
              "color": { "fixedColor": "red", "mode": "fixed" },
              "unit": "errors/s"
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 8, "x": 8, "y": 15 },
          "id": 8,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Scaling Errors Rate",
          "type": "timeseries",
          "targets": [{ "expr": "sum by (schedule) (rate(lightsout_scaling_errors_total[$__rate_interval]))", "legendFormat": "{{ schedule }}", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 10, "lineWidth": 2, "showPoints": "auto", "stacking": { "mode": "none" } },
              "color": { "mode": "palette-classic" },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 8, "x": 16, "y": 15 },
          "id": 9,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Scaling Duration (p50 / p95)",
          "type": "timeseries",
          "targets": [
            { "expr": "histogram_quantile(0.50, sum by (le) (rate(lightsout_scaling_duration_seconds_bucket[$__rate_interval])))", "legendFormat": "p50", "refId": "A" },
            { "expr": "histogram_quantile(0.95, sum by (le) (rate(lightsout_scaling_duration_seconds_bucket[$__rate_interval])))", "legendFormat": "p95", "refId": "B" }
          ]
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 23 },
          "id": 103,
          "title": "Workload Breakdown",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "bars", "fillOpacity": 80, "lineWidth": 1, "stacking": { "mode": "normal" }, "showPoints": "never" },
              "color": { "mode": "palette-classic" }
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 24 },
          "id": 10,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Managed Workloads by Type",
          "type": "timeseries",
          "targets": [{ "expr": "sum by (workload_type) (lightsout_managed_workloads)", "legendFormat": "{{ workload_type }}", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 20, "lineWidth": 2, "showPoints": "auto", "stacking": { "mode": "none" } },
              "color": { "mode": "palette-classic" },
              "unit": "ops"
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 24 },
          "id": 11,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Workloads Processed by Result",
          "type": "timeseries",
          "targets": [{ "expr": "sum by (result) (rate(lightsout_scaling_workloads_processed_total[$__rate_interval]))", "legendFormat": "{{ result }}", "refId": "A" }]
        }
      ],
      "schemaVersion": 39,
      "tags": ["lightsout", "kubernetes", "cost-optimization"],
      "templating": { "list": [] },
      "time": { "from": "now-1h", "to": "now" },
      "timepicker": {},
      "timezone": "",
      "title": "LightsOut - Overview",
      "uid": "lightsout-overview",
      "version": 1
    }
  lightsout-schedule-detail.json: |
    {
      "annotations": { "list": [] },
      "description": "Detailed view of a single LightsOut schedule with workload breakdown, performance metrics, and error tracking.",
      "editable": true,
      "graphTooltip": 1,
      "id": null,
      "links": [{ "icon": "arrow-left", "tags": [], "title": "Back to Overview", "type": "link", "url": "d/lightsout-overview/lightsout-overview" }],
      "panels": [
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
          "id": 100,
          "title": "Schedule: $schedule",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "mappings": [{ "options": { "0": { "text": "Down", "color": "orange" }, "1": { "text": "Up", "color": "green" } }, "type": "value" }],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "orange", "value": null }, { "color": "green", "value": 1 }] },
              "color": { "mode": "thresholds" }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 4, "x": 0, "y": 1 },
          "id": 1,
          "options": {
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "orientation": "auto", "textMode": "auto", "colorMode": "background", "graphMode": "none", "justifyMode": "auto"
          },
          "title": "Current State",
          "type": "stat",
          "targets": [{ "expr": "lightsout_schedule_state{schedule=\"$schedule\"}", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
              "color": { "mode": "thresholds" }, "unit": "s"
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 5, "x": 4, "y": 1 },
          "id": 2,
          "options": {
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "orientation": "auto", "textMode": "auto", "colorMode": "value", "graphMode": "none", "justifyMode": "auto"
          },
          "title": "Next Upscale In",
          "type": "stat",
          "targets": [{ "expr": "lightsout_next_transition_seconds{schedule=\"$schedule\", transition_type=\"upscale\"}", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "thresholds": { "mode": "absolute", "steps": [{ "color": "orange", "value": null }] },
              "color": { "mode": "thresholds" }, "unit": "s"
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 5, "x": 9, "y": 1 },
          "id": 3,
          "options": {
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "orientation": "auto", "textMode": "auto", "colorMode": "value", "graphMode": "none", "justifyMode": "auto"
          },
          "title": "Next Downscale In",
          "type": "stat",
          "targets": [{ "expr": "lightsout_next_transition_seconds{schedule=\"$schedule\", transition_type=\"downscale\"}", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 300 }, { "color": "red", "value": 600 }] },
              "color": { "mode": "thresholds" }, "unit": "s"
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 5, "x": 14, "y": 1 },
          "id": 4,
          "options": {
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "orientation": "auto", "textMode": "auto", "colorMode": "value", "graphMode": "none", "justifyMode": "auto"
          },
          "title": "Last Reconcile Age",
          "type": "stat",
          "targets": [{ "expr": "time() - lightsout_last_reconcile_timestamp_seconds{schedule=\"$schedule\"}", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] },
              "color": { "mode": "thresholds" }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 5, "x": 19, "y": 1 },
          "id": 5,
          "options": {
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "orientation": "auto", "textMode": "auto", "colorMode": "value", "graphMode": "none", "justifyMode": "auto"
          },
          "title": "Errors (24h)",
          "type": "stat",
          "targets": [{ "expr": "sum(increase(lightsout_scaling_errors_total{schedule=\"$schedule\"}[24h])) or vector(0)", "refId": "A" }]
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
          "id": 101,
          "title": "Scaling Timeline",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "line", "lineInterpolation": "stepAfter", "fillOpacity": 30, "lineWidth": 2, "showPoints": "never", "stacking": { "mode": "none" } },
              "mappings": [{ "options": { "0": { "text": "Down" }, "1": { "text": "Up" } }, "type": "value" }],
              "color": { "mode": "palette-classic" }, "min": 0, "max": 1
            },
            "overrides": []
          },
          "gridPos": { "h": 6, "w": 24, "x": 0, "y": 6 },
          "id": 6,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "single", "sort": "none" } },
          "title": "Schedule State Over Time",
          "type": "timeseries",
          "targets": [{ "expr": "lightsout_schedule_state{schedule=\"$schedule\"}", "legendFormat": "State", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "bars", "fillOpacity": 80, "lineWidth": 1, "showPoints": "never", "stacking": { "mode": "normal" } },
              "color": { "mode": "palette-classic" }, "unit": "short"
            },
            "overrides": []
          },
          "gridPos": { "h": 6, "w": 24, "x": 0, "y": 12 },
          "id": 7,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Scaling Operations by Namespace",
          "type": "timeseries",
          "targets": [{ "expr": "sum by (namespace, operation) (increase(lightsout_scaling_operations_total{schedule=\"$schedule\"}[$__rate_interval]))", "legendFormat": "{{ namespace }} ({{ operation }})", "refId": "A" }]
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 18 },
          "id": 102,
          "title": "Workload Details",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 20, "lineWidth": 2, "showPoints": "auto", "stacking": { "mode": "none" } },
              "color": { "mode": "palette-classic" }
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 8, "x": 0, "y": 19 },
          "id": 8,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Managed Workloads by Type",
          "type": "timeseries",
          "targets": [{ "expr": "sum by (workload_type) (lightsout_managed_workloads{schedule=\"$schedule\"})", "legendFormat": "{{ workload_type }}", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 20, "lineWidth": 2, "showPoints": "auto", "stacking": { "mode": "none" } },
              "color": { "mode": "palette-classic" }, "unit": "ops"
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 8, "x": 8, "y": 19 },
          "id": 9,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Workloads Processed by Result",
          "type": "timeseries",
          "targets": [{ "expr": "sum by (result) (rate(lightsout_scaling_workloads_processed_total{schedule=\"$schedule\"}[$__rate_interval]))", "legendFormat": "{{ result }}", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 20, "lineWidth": 2, "showPoints": "auto", "stacking": { "mode": "none" } },
              "color": { "mode": "palette-classic" }
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 8, "x": 16, "y": 19 },
          "id": 10,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Scaling Batches by Direction",
          "type": "timeseries",
          "targets": [{ "expr": "sum by (direction) (rate(lightsout_scaling_batches_total{schedule=\"$schedule\"}[$__rate_interval]))", "legendFormat": "{{ direction }}", "refId": "A" }]
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 27 },
          "id": 103,
          "title": "Performance",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "scaleDistribution": { "type": "log", "log": 2 }, "hideFrom": { "legend": false, "tooltip": false, "viz": false } },
              "color": { "mode": "scheme", "schemeId": "Oranges", "steps": 128 }
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 28 },
          "id": 11,
          "options": {
            "calculate": true, "calculation": { "xBuckets": { "mode": "size" } },
            "cellGap": 1, "color": { "mode": "scheme", "schemeId": "Oranges", "steps": 128 },
            "yAxis": { "unit": "s" }, "tooltip": { "show": true }
          },
          "title": "Scaling Duration Heatmap",
          "type": "heatmap",
          "targets": [{ "expr": "sum by (le) (increase(lightsout_scaling_duration_seconds_bucket{schedule=\"$schedule\"}[$__rate_interval]))", "legendFormat": "{{ le }}", "refId": "A", "format": "heatmap" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 10, "lineWidth": 2, "showPoints": "auto", "stacking": { "mode": "none" } },
              "color": { "mode": "palette-classic" }, "unit": "s"
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 28 },
          "id": 12,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Scaling Duration Percentiles",
          "type": "timeseries",
          "targets": [
            { "expr": "histogram_quantile(0.50, sum by (le, direction) (rate(lightsout_scaling_duration_seconds_bucket{schedule=\"$schedule\"}[$__rate_interval])))", "legendFormat": "p50 {{ direction }}", "refId": "A" },
            { "expr": "histogram_quantile(0.95, sum by (le, direction) (rate(lightsout_scaling_duration_seconds_bucket{schedule=\"$schedule\"}[$__rate_interval])))", "legendFormat": "p95 {{ direction }}", "refId": "B" },
            { "expr": "histogram_quantile(0.99, sum by (le, direction) (rate(lightsout_scaling_duration_seconds_bucket{schedule=\"$schedule\"}[$__rate_interval])))", "legendFormat": "p99 {{ direction }}", "refId": "C" }
          ]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "bars", "fillOpacity": 80, "lineWidth": 1, "showPoints": "never", "stacking": { "mode": "normal" } },
              "color": { "mode": "palette-classic" }, "unit": "ops"
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 24, "x": 0, "y": 36 },
          "id": 13,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Operations by Namespace",
          "type": "timeseries",
          "targets": [{ "expr": "sum by (namespace) (rate(lightsout_scaling_operations_total{schedule=\"$schedule\"}[$__rate_interval]))", "legendFormat": "{{ namespace }}", "refId": "A" }]
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 44 },
          "id": 104,
          "title": "Errors",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "drawStyle": "line", "lineInterpolation": "smooth", "fillOpacity": 30, "lineWidth": 2, "showPoints": "auto", "stacking": { "mode": "none" } },
              "color": { "fixedColor": "red", "mode": "shades" }, "unit": "errors/s"
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 45 },
          "id": 14,
          "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi", "sort": "desc" } },
          "title": "Error Rate by Namespace",
          "type": "timeseries",
          "targets": [{ "expr": "sum by (namespace) (rate(lightsout_scaling_errors_total{schedule=\"$schedule\"}[$__rate_interval]))", "legendFormat": "{{ namespace }}", "refId": "A" }]
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "custom": { "align": "auto", "displayMode": "auto", "inspect": false },
              "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] }
            },
            "overrides": [
              {
                "matcher": { "id": "byName", "options": "Errors" },
                "properties": [
                  { "id": "custom.displayMode", "value": "color-text" },
                  { "id": "thresholds", "value": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 1 }] } }
                ]
              }
            ]
          },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 45 },
          "id": 15,
          "options": { "showHeader": true, "sortBy": [{ "desc": true, "displayName": "Errors" }], "footer": { "show": false } },
          "title": "Errors by Namespace & Workload Type (24h)",
          "type": "table",
          "targets": [{ "expr": "sum by (namespace, workload_type) (increase(lightsout_scaling_errors_total{schedule=\"$schedule\"}[24h])) > 0", "format": "table", "instant": true, "refId": "A" }],
          "transformations": [
            { "id": "organize", "options": {
              "excludeByName": { "Time": true, "__name__": true, "job": true, "instance": true, "schedule": true },
              "renameByName": { "namespace": "Namespace", "workload_type": "Workload Type", "Value": "Errors" }
            }}
          ]
        }
      ],
      "schemaVersion": 39,
      "tags": ["lightsout", "kubernetes", "cost-optimization"],
      "templating": {
        "list": [
          {
            "current": {},
            "datasource": { "type": "prometheus", "uid": "prometheus" },
            "definition": "label_values(lightsout_schedule_state, schedule)",
            "hide": 0,
            "includeAll": false,
            "label": "Schedule",
            "multi": false,
            "name": "schedule",
            "query": { "query": "label_values(lightsout_schedule_state, schedule)", "refId": "StandardVariableQuery" },
            "refresh": 2,
            "sort": 1,
            "type": "query"
          }
        ]
      },
      "time": { "from": "now-1h", "to": "now" },
      "timepicker": {},
      "timezone": "",
      "title": "LightsOut - Schedule Detail",
      "uid": "lightsout-schedule-detail",
      "version": 1
    }
